{"ast":null,"code":"const axios = require('axios');\n\nconst instance = axios.create({\n  baseURL: 'http://localhost:3001/api/'\n});\nlet refreshToken;\ninstance.interceptors.request.use(req => {\n  if (localStorage.getItem(\"JWT\")) {\n    req.headers['authorization'] = `Bearer ${localStorage.getItem(\"JWT\")}`;\n    return req;\n  }\n});\ninstance.interceptors.response.use(response => {\n  console.log(\"REFRESH DONE\");\n  return response;\n}, async error => {\n  const originalRequest = error.config;\n\n  if (error.config.url !== '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\n    originalRequest._retry = true;\n\n    if (refreshToken && refreshToken !== '') {\n      instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\n      console.log('refresh token');\n      await instance.post('/refreshToken').then(response => {\n        instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n        originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\n      }).catch(error => {\n        console.log(error.response.status);\n        refreshToken = null;\n      });\n      return instance(originalRequest);\n    }\n  }\n});\nexport default instance;","map":{"version":3,"names":["axios","require","instance","create","baseURL","refreshToken","interceptors","request","use","req","localStorage","getItem","headers","response","console","log","error","originalRequest","config","url","status","_retry","defaults","common","post","then","data","accessToken","catch"],"sources":["/Users/walidaddouche/Desktop/courseact/src/utils/client.js"],"sourcesContent":["const axios = require('axios');\nconst instance = axios.create({\n    baseURL: 'http://localhost:3001/api/',\n});\n\n\nlet refreshToken;\n\ninstance.interceptors.request.use(req => {\n        if (localStorage.getItem(\"JWT\")) {\n\n            req.headers['authorization'] = `Bearer ${localStorage.getItem(\"JWT\")}`;\n            return req;\n        }\n    }\n)\ninstance.interceptors.response.use((response) => {\n    console.log(\"REFRESH DONE\")\n    return response;\n}, async (error) => {\n    const originalRequest = error.config;\n    if (error.config.url !== '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\n        originalRequest._retry = true;\n        if (refreshToken && refreshToken !== '') {\n            instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\n            console.log('refresh token');\n            await instance.post('/refreshToken').then((response) => {\n                instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n                originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\n            }).catch((error) => {\n                console.log(error.response.status);\n                refreshToken = null;\n            });\n            return instance(originalRequest);\n        }\n    }\n\n});\n\nexport default instance;"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAMC,QAAQ,GAAGF,KAAK,CAACG,MAAN,CAAa;EAC1BC,OAAO,EAAE;AADiB,CAAb,CAAjB;AAKA,IAAIC,YAAJ;AAEAH,QAAQ,CAACI,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CAAkCC,GAAG,IAAI;EACjC,IAAIC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAJ,EAAiC;IAE7BF,GAAG,CAACG,OAAJ,CAAY,eAAZ,IAAgC,UAASF,YAAY,CAACC,OAAb,CAAqB,KAArB,CAA4B,EAArE;IACA,OAAOF,GAAP;EACH;AACJ,CANL;AAQAP,QAAQ,CAACI,YAAT,CAAsBO,QAAtB,CAA+BL,GAA/B,CAAoCK,QAAD,IAAc;EAC7CC,OAAO,CAACC,GAAR,CAAY,cAAZ;EACA,OAAOF,QAAP;AACH,CAHD,EAGG,MAAOG,KAAP,IAAiB;EAChB,MAAMC,eAAe,GAAGD,KAAK,CAACE,MAA9B;;EACA,IAAIF,KAAK,CAACE,MAAN,CAAaC,GAAb,KAAqB,eAArB,IAAwCH,KAAK,CAACH,QAAN,CAAeO,MAAf,KAA0B,GAAlE,IAAyEH,eAAe,CAACI,MAAhB,KAA2B,IAAxG,EAA8G;IAC1GJ,eAAe,CAACI,MAAhB,GAAyB,IAAzB;;IACA,IAAIhB,YAAY,IAAIA,YAAY,KAAK,EAArC,EAAyC;MACrCH,QAAQ,CAACoB,QAAT,CAAkBV,OAAlB,CAA0BW,MAA1B,CAAiC,eAAjC,IAAqD,UAASlB,YAAa,EAA3E;MACAS,OAAO,CAACC,GAAR,CAAY,eAAZ;MACA,MAAMb,QAAQ,CAACsB,IAAT,CAAc,eAAd,EAA+BC,IAA/B,CAAqCZ,QAAD,IAAc;QACpDX,QAAQ,CAACoB,QAAT,CAAkBV,OAAlB,CAA0BW,MAA1B,CAAiC,eAAjC,IAAqD,UAASV,QAAQ,CAACa,IAAT,CAAcC,WAAY,EAAxF;QACAV,eAAe,CAACL,OAAhB,CAAwB,eAAxB,IAA4C,UAASC,QAAQ,CAACa,IAAT,CAAcC,WAAY,EAA/E;MACH,CAHK,EAGHC,KAHG,CAGIZ,KAAD,IAAW;QAChBF,OAAO,CAACC,GAAR,CAAYC,KAAK,CAACH,QAAN,CAAeO,MAA3B;QACAf,YAAY,GAAG,IAAf;MACH,CANK,CAAN;MAOA,OAAOH,QAAQ,CAACe,eAAD,CAAf;IACH;EACJ;AAEJ,CArBD;AAuBA,eAAef,QAAf"},"metadata":{},"sourceType":"module"}