{"ast":null,"code":"const axios = require('axios');\n\nconst instance = axios.create({\n  baseURL: 'http://localhost:3001/api/'\n});\nlet refreshToken;\ninstance.interceptors.request.use(req => {\n  if (localStorage.getItem(\"JWT\")) {\n    instance.defaults.headers.common['authorization'] = `Bearer ${localStorage.getItem(\"JWT\")}`;\n    return req;\n  }\n});\ninstance.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  const originalRequest = error.config;\n\n  if (error.config.url != '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\n    originalRequest._retry = true;\n\n    if (refreshToken && refreshToken != '') {\n      instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\n      console.log('refresh token');\n      await instance.post('/refreshToken').then(response => {\n        instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n        originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\n      }).catch(error => {\n        console.log(error.response.status);\n        refreshToken = null;\n      });\n      return instance(originalRequest);\n    }\n  }\n});\nexport default instance;","map":{"version":3,"names":["axios","require","instance","create","baseURL","refreshToken","interceptors","request","use","req","localStorage","getItem","defaults","headers","common","response","error","originalRequest","config","url","status","_retry","console","log","post","then","data","accessToken","catch"],"sources":["/Users/walidaddouche/Desktop/courseact/src/utils/client.js"],"sourcesContent":["const axios = require('axios');\nconst instance = axios.create({\n    baseURL: 'http://localhost:3001/api/',\n});\n\n\nlet refreshToken;\n\ninstance.interceptors.request.use(req=>{\n    if(localStorage.getItem(\"JWT\")){\n        instance.defaults.headers.common['authorization'] = `Bearer ${localStorage.getItem(\"JWT\")}`;\n        return req;\n    }\n    }\n\n)\ninstance.interceptors.response.use((response) => {\n    return response;\n}, async (error) => {\n    const originalRequest = error.config;\n    if (error.config.url != '/refreshToken' && error.response.status === 401 && originalRequest._retry !== true) {\n        originalRequest._retry = true;\n        if (refreshToken && refreshToken != '') {\n            instance.defaults.headers.common['authorization'] = `Bearer ${refreshToken}`;\n            console.log('refresh token');\n            await instance.post('/refreshToken').then((response) => {\n                instance.defaults.headers.common['authorization'] = `Bearer ${response.data.accessToken}`;\n                originalRequest.headers['authorization'] = `Bearer ${response.data.accessToken}`;\n            }).catch((error) => {\n                console.log(error.response.status);\n                refreshToken = null;\n            });\n            return instance(originalRequest);\n        }\n    }\n});\n\nexport default instance;"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAMC,QAAQ,GAAGF,KAAK,CAACG,MAAN,CAAa;EAC1BC,OAAO,EAAE;AADiB,CAAb,CAAjB;AAKA,IAAIC,YAAJ;AAEAH,QAAQ,CAACI,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CAAkCC,GAAG,IAAE;EACnC,IAAGC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAH,EAA+B;IAC3BT,QAAQ,CAACU,QAAT,CAAkBC,OAAlB,CAA0BC,MAA1B,CAAiC,eAAjC,IAAqD,UAASJ,YAAY,CAACC,OAAb,CAAqB,KAArB,CAA4B,EAA1F;IACA,OAAOF,GAAP;EACH;AACA,CALL;AAQAP,QAAQ,CAACI,YAAT,CAAsBS,QAAtB,CAA+BP,GAA/B,CAAoCO,QAAD,IAAc;EAC7C,OAAOA,QAAP;AACH,CAFD,EAEG,MAAOC,KAAP,IAAiB;EAChB,MAAMC,eAAe,GAAGD,KAAK,CAACE,MAA9B;;EACA,IAAIF,KAAK,CAACE,MAAN,CAAaC,GAAb,IAAoB,eAApB,IAAuCH,KAAK,CAACD,QAAN,CAAeK,MAAf,KAA0B,GAAjE,IAAwEH,eAAe,CAACI,MAAhB,KAA2B,IAAvG,EAA6G;IACzGJ,eAAe,CAACI,MAAhB,GAAyB,IAAzB;;IACA,IAAIhB,YAAY,IAAIA,YAAY,IAAI,EAApC,EAAwC;MACpCH,QAAQ,CAACU,QAAT,CAAkBC,OAAlB,CAA0BC,MAA1B,CAAiC,eAAjC,IAAqD,UAAST,YAAa,EAA3E;MACAiB,OAAO,CAACC,GAAR,CAAY,eAAZ;MACA,MAAMrB,QAAQ,CAACsB,IAAT,CAAc,eAAd,EAA+BC,IAA/B,CAAqCV,QAAD,IAAc;QACpDb,QAAQ,CAACU,QAAT,CAAkBC,OAAlB,CAA0BC,MAA1B,CAAiC,eAAjC,IAAqD,UAASC,QAAQ,CAACW,IAAT,CAAcC,WAAY,EAAxF;QACAV,eAAe,CAACJ,OAAhB,CAAwB,eAAxB,IAA4C,UAASE,QAAQ,CAACW,IAAT,CAAcC,WAAY,EAA/E;MACH,CAHK,EAGHC,KAHG,CAGIZ,KAAD,IAAW;QAChBM,OAAO,CAACC,GAAR,CAAYP,KAAK,CAACD,QAAN,CAAeK,MAA3B;QACAf,YAAY,GAAG,IAAf;MACH,CANK,CAAN;MAOA,OAAOH,QAAQ,CAACe,eAAD,CAAf;IACH;EACJ;AACJ,CAnBD;AAqBA,eAAef,QAAf"},"metadata":{},"sourceType":"module"}